<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Zhangsheng  Lai | Reading Casper CBC proofs - Part 4</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêî</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2021/reading-casper-cbc-proofs-p4/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>



  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-73850109-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-73850109-1');
  </script>




    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Zhangsheng</span>   Lai
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                teaching
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Reading Casper CBC proofs - Part 4</h1>
    <p class="post-meta">June 10, 2021</p>
  </header>

  <article class="post-content">
    <p>In this last part, we will be completing the reading of <code class="language-plaintext highlighter-rouge">Binary.v</code>.
Our previous reading ended with an inductive definition <code class="language-plaintext highlighter-rouge">protocol_state</code> which validates if a given <code class="language-plaintext highlighter-rouge">sigma : state</code> satisfies the requirements of a protocol state, followed by establishing some properties of the terms of <code class="language-plaintext highlighter-rouge">protocol_state sigma</code> for some given <code class="language-plaintext highlighter-rouge">sigma</code>.</p>

<p>Let‚Äôs begin.</p>

<p>The first declaration is an <code class="language-plaintext highlighter-rouge">Instance</code> <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Protocol.v#L27"><code class="language-plaintext highlighter-rouge">CBC_protocol_eq</code></a>, a <em>class of consensus values with reflexive and transitive comparisons</em>.
The <code class="language-plaintext highlighter-rouge">CBC_protocol_eq</code> is a <code class="language-plaintext highlighter-rouge">Class</code> is defined in <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Protocol.v"><code class="language-plaintext highlighter-rouge">Protocol.v</code></a> thus in the preamble of <code class="language-plaintext highlighter-rouge">Binary.v</code>, <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Binary.v#L4"><code class="language-plaintext highlighter-rouge">CBC.Protocol</code></a> is imported for us to be able to call on it.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Instance</span><span class="w"> </span><span class="no">LightNode_seteq</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">CBC_protocol_eq</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
   </span><span class="o">{</span><span class="w"> </span><span class="c">(* &gt;&gt; *)</span><span class="w"> </span><span class="no">consensus_values</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">C</span><span class="p">;</span><span class="w">
     </span><span class="c">(* &gt;&gt; *)</span><span class="w"> </span><span class="no">about_consensus_values</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">about_C</span><span class="p">;</span><span class="w">
     </span><span class="no">validators</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">V</span><span class="p">;</span><span class="w">
     </span><span class="no">about_validators</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">about_V</span><span class="p">;</span><span class="w">
     </span><span class="no">weight</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">weight</span><span class="p">;</span><span class="w">
     </span><span class="no">t</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">t_full</span><span class="p">;</span><span class="w">
     </span><span class="no">suff_val</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">suff_val_full</span><span class="p">;</span><span class="w">
     </span><span class="no">state</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">state</span><span class="p">;</span><span class="w">
     </span><span class="no">about_state</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">about_state</span><span class="p">;</span><span class="w">
     </span><span class="no">state0</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">state0</span><span class="p">;</span><span class="w">
     </span><span class="no">state_eq</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">state_eq</span><span class="p">;</span><span class="w">
     </span><span class="no">state_union</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">state_union</span><span class="p">;</span><span class="w">
     </span><span class="no">state_union_comm</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">state_union_comm</span><span class="p">;</span><span class="w">
     </span><span class="no">reach</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">reach</span><span class="p">;</span><span class="w">
     </span><span class="no">reach_refl</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">reach_refl</span><span class="p">;</span><span class="w">
     </span><span class="no">reach_trans</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">reach_trans</span><span class="p">;</span><span class="w">
     </span><span class="no">reach_union</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">reach_union</span><span class="p">;</span><span class="w">
     </span><span class="no">reach_morphism</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">reach_morphism</span><span class="p">;</span><span class="w">
     </span><span class="c">(* &gt;&gt; *)</span><span class="w"> </span><span class="no">E</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">binEstimator</span><span class="p">;</span><span class="w">
     </span><span class="no">estimator_total</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">estimator_total</span><span class="p">;</span><span class="w">
     </span><span class="no">prot_state</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">protocol_state</span><span class="p">;</span><span class="w">
     </span><span class="no">about_state0</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">protocol_state_nil</span><span class="p">;</span><span class="w">
     </span><span class="no">equivocation_weight</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">fault_weight_state</span><span class="p">;</span><span class="w">
     </span><span class="no">equivocation_weight_compat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">equivocation_weight_compat</span><span class="p">;</span><span class="w">
     </span><span class="no">about_prot_state</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">about_prot_state</span><span class="p">;</span><span class="w">
   </span><span class="o">}.</span><span class="w">
</span></code></pre></div></div>

<p><strong>Slight digression.</strong> The notion of <code class="language-plaintext highlighter-rouge">Class</code> and <code class="language-plaintext highlighter-rouge">Instance</code> in Coq is similar to the <a href="https://docs.python.org/3/tutorial/classes.html">concept of a class in Python and objects of a Python class is instantiated by a function notation</a>.
The equivalent functionality in Coq is called <a href="https://coq.inria.fr/refman/addendum/type-classes.html"><em>typeclasses</em></a>.
An introductory tutorial of Coq‚Äôs typeclasses can be found <a href="https://softwarefoundations.cis.upenn.edu/draft/qc-current/Typeclasses.html">here</a> and <a href="https://www.labri.fr/perso/casteran/CoqArt/TypeClassesTut/typeclassestut.pdf">here</a>.
It bears some similarities to Coq‚Äôs dependent record types; refer to stackoverflow discussion <a href="https://stackoverflow.com/questions/29872260/coq-typeclasses-vs-dependent-records">here</a> which seems to suggest typeclasses are more suitable for defining mathematical objects.
My personal understanding is that by bundling dependent record types with canonical declarations which is better known as <a href="https://hal.inria.fr/hal-00816703v1/document"><em>canonical structures</em></a>, they provide better utility than typeclasses due to the programmable type inferencing.</p>

<p>With the end of my digression, we move on to understand what this chunk of <code class="language-plaintext highlighter-rouge">LightNode_seteq</code> is all about.
What forms a class of consensus values with with reflexive and transitive comparisons?
The answer is found from the <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Protocol.v#L25"><code class="language-plaintext highlighter-rouge">Class</code> declaration of <code class="language-plaintext highlighter-rouge">CBC_protocol_eq</code> defined in <code class="language-plaintext highlighter-rouge">Protocol.v</code></a>.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Class</span><span class="w"> </span><span class="no">CBC_protocol_eq</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
   </span><span class="o">{</span><span class="w">
      </span><span class="c">(** Consensus values equipped with reflexive transitive comparison **)</span><span class="w">
      </span><span class="no">consensus_values</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="p">;</span><span class="w">
      </span><span class="no">about_consensus_values</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">StrictlyComparable</span><span class="w"> </span><span class="no">consensus_values</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Validators equipped with reflexive transitive comparison **)</span><span class="w">
      </span><span class="no">validators</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="p">;</span><span class="w">
      </span><span class="no">about_validators</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">StrictlyComparable</span><span class="w"> </span><span class="no">validators</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Weights are positive reals **)</span><span class="w">
      </span><span class="no">weight</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">validators</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">{</span><span class="no">r</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">)%</span><span class="no">R</span><span class="o">}</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Threshold is a non-negative real **)</span><span class="w">
      </span><span class="no">t</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">{</span><span class="no">r</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">r</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="o">)%</span><span class="no">R</span><span class="o">}</span><span class="p">;</span><span class="w">
      </span><span class="no">suff_val</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="no">vs</span><span class="o">,</span><span class="w"> </span><span class="no">NoDup</span><span class="w"> </span><span class="no">vs</span><span class="w"> </span><span class="o">/\</span><span class="w"> </span><span class="o">((</span><span class="no">fold_right</span><span class="w"> </span><span class="o">(</span><span class="kr">fun</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">proj1_sig</span><span class="w"> </span><span class="o">(</span><span class="no">weight</span><span class="w"> </span><span class="no">v</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">r</span><span class="o">)%</span><span class="no">R</span><span class="o">)</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="no">R</span><span class="o">)</span><span class="w"> </span><span class="no">vs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">proj1_sig</span><span class="w"> </span><span class="no">t</span><span class="o">))%</span><span class="no">R</span><span class="p">;</span><span class="w">
      </span><span class="c">(** States with equality and union **)</span><span class="w">
      </span><span class="no">state</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="p">;</span><span class="w">
      </span><span class="no">about_state</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">StrictlyComparable</span><span class="w"> </span><span class="no">state</span><span class="p">;</span><span class="w">
      </span><span class="no">state0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="p">;</span><span class="w">
      </span><span class="no">state_eq</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="p">;</span><span class="w">
      </span><span class="no">state_union</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">state</span><span class="p">;</span><span class="w">
      </span><span class="no">state_union_comm</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">,</span><span class="w"> </span><span class="no">state_eq</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s1</span><span class="o">)</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Reachability relation **)</span><span class="w">
      </span><span class="no">reach</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="p">;</span><span class="w">
      </span><span class="no">reach_refl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s</span><span class="o">,</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">s</span><span class="p">;</span><span class="w">
      </span><span class="no">reach_trans</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s3</span><span class="o">,</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s3</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s3</span><span class="p">;</span><span class="w">
      </span><span class="no">reach_union</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">,</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">)</span><span class="p">;</span><span class="w">
      </span><span class="no">reach_morphism</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s3</span><span class="o">,</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">state_eq</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s3</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">reach</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s3</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Total estimator **)</span><span class="w">
      </span><span class="no">E</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">consensus_values</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="p">;</span><span class="w">
      </span><span class="no">estimator_total</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s</span><span class="o">,</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="no">c</span><span class="o">,</span><span class="w"> </span><span class="no">E</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">c</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Protocol state definition as predicate **)</span><span class="w">
      </span><span class="no">prot_state</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="p">;</span><span class="w">
      </span><span class="no">about_state0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">prot_state</span><span class="w"> </span><span class="no">state0</span><span class="p">;</span><span class="w">
      </span><span class="c">(** Equivocation weights from states **)</span><span class="w">
      </span><span class="no">equivocation_weight</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">R</span><span class="p">;</span><span class="w">
      </span><span class="no">equivocation_weight_compat</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">,</span><span class="w"> </span><span class="o">(</span><span class="no">equivocation_weight</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="no">equivocation_weight</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="no">s1</span><span class="o">))%</span><span class="no">R</span><span class="p">;</span><span class="w">
      </span><span class="no">about_prot_state</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">,</span><span class="w"> </span><span class="no">prot_state</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">prot_state</span><span class="w"> </span><span class="no">s2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
                                  </span><span class="o">(</span><span class="no">equivocation_weight</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="no">proj1_sig</span><span class="w"> </span><span class="no">t</span><span class="o">)%</span><span class="no">R</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">prot_state</span><span class="w"> </span><span class="o">(</span><span class="no">state_union</span><span class="w"> </span><span class="no">s1</span><span class="w"> </span><span class="no">s2</span><span class="o">)</span><span class="p">;</span><span class="w">
   </span><span class="o">}.</span><span class="w">
</span></code></pre></div></div>

<p>Thus we will go through the methods of the <code class="language-plaintext highlighter-rouge">CBC_protocol_eq</code> class (the declarations of the class) and we will then see that the terms provided to the methods for <code class="language-plaintext highlighter-rouge">LightNode_seteq</code> are taken from the various definitions defined earlier in <code class="language-plaintext highlighter-rouge">Binary.v</code>.</p>

<p>First we need a few data types: consensus values <code class="language-plaintext highlighter-rouge">C</code>, validators <code class="language-plaintext highlighter-rouge">V</code> and protocol states <code class="language-plaintext highlighter-rouge">state</code>, and also verification of these data types satisfying the <code class="language-plaintext highlighter-rouge">StrictlyComparable</code> property in the form of the terms <code class="language-plaintext highlighter-rouge">about_C</code>, <code class="language-plaintext highlighter-rouge">about_V</code>, and <code class="language-plaintext highlighter-rouge">about_state</code>.
Next we introduce the relevant operators which are then used to establish properties for two of these three data types.</p>

<p>For validators, we require a <code class="language-plaintext highlighter-rouge">weight</code> function which assigns each validator to a positive weight value, a Byzantine fault tolerance threshold <code class="language-plaintext highlighter-rouge">t_full</code>, and <code class="language-plaintext highlighter-rouge">suff_val_full</code> which says that there exists a set of validators where the sum of their weights are above the fault tolerance threshold.</p>

<p>For states, an initial protocol state \(\sigma_0\) needs to be provided, <code class="language-plaintext highlighter-rouge">state_eq</code> checks if two states are equal,  and <code class="language-plaintext highlighter-rouge">state_union</code> to create a new state from the union of two states.
A proof that union of states is commutative, is proved to <code class="language-plaintext highlighter-rouge">state_union_comm</code>.</p>

<p>The notion of reachability over states is defined by the <code class="language-plaintext highlighter-rouge">reach</code> operator.
This <code class="language-plaintext highlighter-rouge">reach</code> operator is required to be reflexive (<code class="language-plaintext highlighter-rouge">reach_refl</code>), transitive (<code class="language-plaintext highlighter-rouge">reach_trans</code>), reachable to its union (<code class="language-plaintext highlighter-rouge">reach_union</code>), and starting from a state, if it can reach another state, its equivalent states are also reachable (<code class="language-plaintext highlighter-rouge">reach_morphism</code>).</p>

<p>With states and consensus values, we can talk about estimating a consensus value given a state. 
An estimator <code class="language-plaintext highlighter-rouge">E</code> is needed and we require this estimator to be total (<code class="language-plaintext highlighter-rouge">estimator_total</code>), which means a consensus value can be estimated for any given state.</p>

<p>A protocol state is a list of messages satisfying some property, and the properties are verified using the provided <code class="language-plaintext highlighter-rouge">prot_state</code>.
Using <code class="language-plaintext highlighter-rouge">prot_state</code>, <code class="language-plaintext highlighter-rouge">about_state0</code> verifies that the given <code class="language-plaintext highlighter-rouge">state0</code> is a valid protocol state.</p>

<p>The remaining three methods are related to equivocating weights.
The function <code class="language-plaintext highlighter-rouge">equivocation_weight</code> calculates the weight of equivocating senders, and other two are the properties of <code class="language-plaintext highlighter-rouge">equivocation_weight</code> which we went through in <a href="https://zunction.github.io/blog/2021/reading-casper-cbc-proofs-p3/">Part 3</a>.</p>

<p>The remaining three lines in <code class="language-plaintext highlighter-rouge">Binary.v</code> are defined on <code class="language-plaintext highlighter-rouge">locked_on</code> and <code class="language-plaintext highlighter-rouge">not_locked_off</code>, which are defined in <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/e32e74997d8fd53b44e8e87add22e9ee1de5d175/CBC/Protocol.v#L239"><code class="language-plaintext highlighter-rouge">Consistency</code> section</a> of <code class="language-plaintext highlighter-rouge">Protocol.v</code>.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">bivalent</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">pstate</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="o">(</span><span class="no">s</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">pstate</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">not_locked_off</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">/\</span><span class="w"> </span><span class="no">not_locked_off</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="no">s</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">stuck</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">pstate</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">Prop</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="o">(</span><span class="no">s</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">pstate</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">locked_off</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">/\</span><span class="w"> </span><span class="no">locked_off</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="no">s</span><span class="pi">.</span><span class="w">

</span><span class="k">Lemma</span><span class="w"> </span><span class="no">locked_on_off</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">s</span><span class="o">,</span><span class="w"> </span><span class="no">locked_on</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">locked_off</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="no">s</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>As the definitions are build on other functions which we have not seen in <code class="language-plaintext highlighter-rouge">Binary.v</code>, we will defer their discussion for the time being, and return to update when those definitions make sense to me.</p>

<p><strong>Conclusions.</strong> It has been a fun experience reading <code class="language-plaintext highlighter-rouge">Binary.v</code>, complemented with the material in <a href="https://github.com/cbc-casper/cbc-casper-paper/blob/master/cbc-casper-paper-draft.pdf">CBC Casper family of consensus protocol</a>.
Reading their formalisation in Coq has also allowed me to better understand the content in the paper; the implementations in Coq has allowed me to identify the parts which I did not really understand and gain increased understanding of the definitions in finer detail which would not have been possible by simply just reading.
Midway reading, I realised that the chronological order of the files mean that <code class="language-plaintext highlighter-rouge">Protocol.v</code> is the starting file, and thus has lead to some definitions which are not defined in <code class="language-plaintext highlighter-rouge">Binary.v</code>.</p>

<p>My next reading will be on <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Protocol.v"><code class="language-plaintext highlighter-rouge">Protocol.v</code></a> and please stay tuned!</p>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'zunction';
      var disqus_identifier = '/blog/2021/reading-casper-cbc-proofs-p4';
      var disqus_title      = "Reading Casper CBC proofs - Part 4";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Zhangsheng  Lai.
    
    
    
    Last updated: July 02, 2021.
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
