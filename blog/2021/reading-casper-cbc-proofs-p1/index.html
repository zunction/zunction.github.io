<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Zhangsheng  Lai | Reading Casper CBC proofs - Part 1</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêî</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2021/reading-casper-cbc-proofs-p1/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>



  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-73850109-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-73850109-1');
  </script>




    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Zhangsheng</span>   Lai
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                teaching
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Reading Casper CBC proofs - Part 1</h1>
    <p class="post-meta">May 16, 2021</p>
  </header>

  <article class="post-content">
    <p>Recently I have been reading about the <a href="https://github.com/cbc-casper/cbc-casper-paper/blob/master/cbc-casper-paper-draft.pdf">CBC Casper family of consensus protocol</a> where CBC means <em>correct-by-construction</em>.
The people at <a href="https://runtimeverification.com/">runtime verification</a> have done the <a href="https://github.com/runtimeverification/casper-cbc-proofs">protocol verification of Casper Correct-By-Construction in Coq</a>.</p>

<p>Here, I will attempt to understand how the formal verification Casper is being done in Coq. 
In particular, I will be going through the code <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Binary.v"><code class="language-plaintext highlighter-rouge">Binary.v</code></a> to inspect what is being done in it. 
The code in <code class="language-plaintext highlighter-rouge">Binary.v</code> follows closely the content in the paper: <a href="https://github.com/cbc-casper/cbc-casper-paper/blob/master/cbc-casper-paper-draft.pdf">Introducing the ‚ÄúMinimal CBC Casper‚Äù Family of Consensus Protocols</a>; I would recommend reading this paper first so you would be able to relate to the definitions and proofs in <code class="language-plaintext highlighter-rouge">Binary.v</code>.</p>

<p>Let‚Äôs begin.</p>

<p>The first definition describes the possible decisions of a <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Binary.v#L13">binary consensus protocol</a>. 
At the moment, it is not clear why <code class="language-plaintext highlighter-rouge">C_inhabited</code> is defined as the term <code class="language-plaintext highlighter-rouge">one : C</code>, but as we go progress further we might be able to make some sense of this definition.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">C_inhabited</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">one</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">C_compare</code> function is a comparison operator on the consensus. 
This operator returns a term of the <a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#comparison"><code class="language-plaintext highlighter-rouge">comparison</code></a> datatype provided in the default Coq library. 
Based on the usual semantics of <code class="language-plaintext highlighter-rouge">zero</code> and <code class="language-plaintext highlighter-rouge">one</code>, when any of these two terms are compared, the possible outputs are the comparison datatype has three terms, <code class="language-plaintext highlighter-rouge">Eq</code>, <code class="language-plaintext highlighter-rouge">Lt</code> and <code class="language-plaintext highlighter-rouge">Gt</code> which means equal, lesser than and greater than respectively.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">C_compare</span><span class="w"> </span><span class="o">(</span><span class="no">c1</span><span class="w"> </span><span class="no">c2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">comparison</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">c1</span><span class="w"> </span><span class="kp">with</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kr">match</span><span class="w"> </span><span class="no">c2</span><span class="w"> </span><span class="kp">with</span><span class="w">
      </span><span class="o">|</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Eq</span><span class="w">
      </span><span class="o">|</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Lt</span><span class="w">
        </span><span class="kr">end</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kr">match</span><span class="w"> </span><span class="no">c2</span><span class="w"> </span><span class="kp">with</span><span class="w">
      </span><span class="o">|</span><span class="w"> </span><span class="no">zero</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Gt</span><span class="w">
      </span><span class="o">|</span><span class="w"> </span><span class="no">one</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">Eq</span><span class="w">
        </span><span class="kr">end</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">C_compare</code> operator has some properties that come along with it based on its definition.
When performing formal verification, these properties have to be formally verified the paper and pen approach where we normally use these properties for free without explicitly proving them.
The reflexive and transitive properties of <code class="language-plaintext highlighter-rouge">C_compare</code> are formally proven with <code class="language-plaintext highlighter-rouge">C_compare_reflexive</code> and <code class="language-plaintext highlighter-rouge">C_compare_transitive</code> respectively, and <code class="language-plaintext highlighter-rouge">C_compare_strictorder</code> is a proof that an operator satisfies the <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/e32e74997d8fd53b44e8e87add22e9ee1de5d175/Lib/Preamble.v#L291">`CompareStrictOrder‚Äô</a>: an operator having the reflexive and transitive properties.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Lemma</span><span class="w"> </span><span class="no">C_compare_reflexive</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">CompareReflexive</span><span class="w"> </span><span class="no">C_compare</span><span class="pi">.</span><span class="w">
</span><span class="k">Lemma</span><span class="w"> </span><span class="no">C_compare_transitive</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">CompareTransitive</span><span class="w"> </span><span class="no">C_compare</span><span class="pi">.</span><span class="w">
</span><span class="k">Lemma</span><span class="w"> </span><span class="no">C_compare_strictorder</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">CompareStrictOrder</span><span class="w"> </span><span class="no">C_compare</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Here, we say the consensus protocol <code class="language-plaintext highlighter-rouge">C</code> is <code class="language-plaintext highlighter-rouge">StrictlyComparable</code> when it is nonempty (provided by the <code class="language-plaintext highlighter-rouge">C_inhabited</code> term defined earlier), has a comparison operator and has strict-orderedness property.</p>
<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Instance</span><span class="w"> </span><span class="no">about_C</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">StrictlyComparable</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">{</span><span class="w"> </span><span class="no">inhabited</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">C_inhabited</span><span class="p">;</span><span class="w">
    </span><span class="no">compare</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">C_compare</span><span class="p">;</span><span class="w">
    </span><span class="no">compare_strictorder</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">C_compare_strictorder</span><span class="p">;</span><span class="w">
  </span><span class="o">}.</span><span class="w"> 
</span></code></pre></div></div>

<p>Up to now, the work has been focused on establishing the properties of the binary consensus comparison operator.
We finally move towards defining some definitions that are found in \(\S 2\) Description of CBC Casper.
Positive reals are first defined using <a href="https://coq.inria.fr/library/Coq.Init.Specif.html#sig">sigma types</a>, on the real numbers obtained through the package imported in the <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/master/CBC/Binary.v#L1">preamble</a>.
A coercion <code class="language-plaintext highlighter-rouge">posR_proj1</code> is declared, which allows functions defined on real numbers to also be usable for positive real numbers as it helps change the type of a term into another by automatically inserting a function, which in this case is <code class="language-plaintext highlighter-rouge">posR_proj1</code> to prevent type error.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">posR</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="no">r</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">)%</span><span class="no">R</span><span class="o">}.</span><span class="w">
</span><span class="k">Definition</span><span class="w"> </span><span class="no">posR_proj1</span><span class="w"> </span><span class="o">(</span><span class="no">r</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">posR</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">proj1_sig</span><span class="w"> </span><span class="no">r</span><span class="pi">.</span><span class="w">
</span><span class="no">Coercion</span><span class="w"> </span><span class="no">posR_proj1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">posR</span><span class="w"> </span><span class="o">&gt;-&gt;</span><span class="w"> </span><span class="no">R</span><span class="pi">.</span><span class="w"> 
</span></code></pre></div></div>

<p>We can now define validator weights as  <code class="language-plaintext highlighter-rouge">weight</code> which maps a given validator \(v \in \mathcal{V}\) to a positive real number. 
The <code class="language-plaintext highlighter-rouge">sum_weights</code> builds upon <code class="language-plaintext highlighter-rouge">weight</code> to sum the weights of a list of validators given a list of validators <code class="language-plaintext highlighter-rouge">l</code>.
The parameter <code class="language-plaintext highlighter-rouge">t_full</code> denote the Byzantine-fault-tolerance threshold.
As for the parameter <code class="language-plaintext highlighter-rouge">suff_val_full</code>, it specifies the existence of a set of validators where the <code class="language-plaintext highlighter-rouge">sum_weights</code> is above the threshold <code class="language-plaintext highlighter-rouge">t_full</code>.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Parameter</span><span class="w"> </span><span class="no">weight</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">V</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">posR</span><span class="pi">.</span><span class="w"> 

</span><span class="k">Definition</span><span class="w"> </span><span class="no">sum_weights</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">V</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">R</span><span class="w"> 
  </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">fold_right</span><span class="w"> </span><span class="o">(</span><span class="kr">fun</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">((</span><span class="no">weight</span><span class="w"> </span><span class="no">v</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">r</span><span class="o">)%</span><span class="no">R</span><span class="o">)</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="no">R</span><span class="w"> </span><span class="no">l</span><span class="pi">.</span><span class="w">

</span><span class="no">Parameter</span><span class="w"> </span><span class="o">(</span><span class="no">t_full</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">{</span><span class="no">r</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">(</span><span class="no">r</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="o">)%</span><span class="no">R</span><span class="o">})</span><span class="w"> 
</span><span class="no">Parameter</span><span class="w"> </span><span class="o">(</span><span class="no">suff_val_full</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kp">exists</span><span class="w"> </span><span class="no">vs</span><span class="o">,</span><span class="w"> </span><span class="no">NoDup</span><span class="w"> </span><span class="no">vs</span><span class="w"> </span><span class="o">/\</span><span class="w"> </span><span class="o">((</span><span class="no">fold_right</span><span class="w"> </span><span class="o">(</span><span class="kr">fun</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">((</span><span class="no">weight</span><span class="w"> </span><span class="no">v</span><span class="o">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">r</span><span class="o">)%</span><span class="no">R</span><span class="o">)</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="no">R</span><span class="o">)</span><span class="w"> </span><span class="no">vs</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">proj1_sig</span><span class="w"> </span><span class="no">t_full</span><span class="o">))%</span><span class="no">R</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>The next few definitions are about the protocol state which are called justification. 
In the definition, justification is a list of elements of type <code class="language-plaintext highlighter-rouge">H</code> suggesting a list of <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hashes</a>.
Similar to the binary consensus <code class="language-plaintext highlighter-rouge">C</code>, we also establish that <code class="language-plaintext highlighter-rouge">justification_type</code> is also <code class="language-plaintext highlighter-rouge">StrictlyComparable</code> on the definitions below.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">H</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">justification_type_inhabited</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">[].</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">justification_compare</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">(</span><span class="no">justification_type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">comparison</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">list_compare</span><span class="w"> </span><span class="no">compare</span><span class="pi">.</span><span class="w">

</span><span class="k">Instance</span><span class="w"> </span><span class="no">about_justification_type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">StrictlyComparable</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">{</span><span class="w"> </span><span class="no">inhabited</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">justification_type_inhabited</span><span class="p">;</span><span class="w">
    </span><span class="no">compare</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">list_compare</span><span class="w"> </span><span class="no">compare</span><span class="p">;</span><span class="w">
    </span><span class="no">compare_strictorder</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">list_compare_strict_order</span><span class="p">;</span><span class="w">
  </span><span class="o">}.</span><span class="w">
</span></code></pre></div></div>
<p>The next few are protocol definitions which define what a message is and the auxiliary projection functions for messages which allows us to project out the various components of a message.
The <a href="https://github.com/runtimeverification/casper-cbc-proofs/blob/e32e74997d8fd53b44e8e87add22e9ee1de5d175/Lib/Preamble.v#L699"><code class="language-plaintext highlighter-rouge">TripleStrictlyComparable</code></a> is an instance which helps to establish that the triple <code class="language-plaintext highlighter-rouge">message_type</code> is strictly comparable, given that the types forming triple are also strictly comparable.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">V</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">justification_type</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">message_type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">TripleStrictlyComparable</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="no">V</span><span class="w"> </span><span class="no">justification_type</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">estimate</span><span class="w"> </span><span class="o">(</span><span class="no">msg</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">message</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">msg</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">(</span><span class="no">c</span><span class="o">,</span><span class="w"> </span><span class="p">_</span><span class="o">,</span><span class="w"> </span><span class="p">_</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">c</span><span class="w"> </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">sender</span><span class="w"> </span><span class="o">(</span><span class="no">msg</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">message</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">V</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">msg</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">(</span><span class="p">_</span><span class="o">,</span><span class="w"> </span><span class="no">v</span><span class="o">,</span><span class="w"> </span><span class="p">_</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">justification</span><span class="w"> </span><span class="o">(</span><span class="no">msg</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">message</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">msg</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="o">(</span><span class="p">_</span><span class="o">,</span><span class="w"> </span><span class="p">_</span><span class="o">,</span><span class="w"> </span><span class="no">j</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">j</span><span class="w"> </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>I personally feel that a Coq record (presented below) would be a better way to represent the definition of <code class="language-plaintext highlighter-rouge">message</code> as it comes with projection functions, also the constructor <code class="language-plaintext highlighter-rouge">mkMsg</code> as compared to the triple definition above will help ensure that errant messages are not created by accident.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Record</span><span class="w"> </span><span class="no">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">mkMsg</span><span class="w"> </span><span class="o">{</span><span class="w">  </span><span class="no">estimate</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">C</span><span class="p">;</span><span class="w">  
                                    </span><span class="no">sender</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">V</span><span class="p">;</span><span class="w">  
                             </span><span class="no">justification</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">justification_type</span><span class="w"> </span><span class="o">}</span><span class="w">
</span></code></pre></div></div>

<p>This leaves us at line 88 of <code class="language-plaintext highlighter-rouge">Binary.v</code> out of the total 489 lines. 
In the subsequent few lines, the definitions starts working on the protocol states, thus it is a good time to end and in the next part we shall look at the treatment of the protocol states.
I hope this write-up provides a clear, readable way of understanding the code.
Comments and questions are very welcomed :)</p>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'zunction';
      var disqus_identifier = '/blog/2021/reading-casper-cbc-proofs-p1';
      var disqus_title      = "Reading Casper CBC proofs - Part 1";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Zhangsheng  Lai.
    
    
    
    Last updated: July 02, 2021.
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
